!function(t,e){"function"==typeof define&&define.amd?define(["React"],e):"object"==typeof exports?module.exports=e(require("React")):t.ReactSortable=e(t.React)}(this,function(t){function e(t){for(;t;){if(t.className&&t.className.indexOf("react-sortable-item")>=0)return t;t=t.parentNode}return null}function a(t){for(var e,a=t.parentNode,o=a.children,i=1/0,n=null,s=t.offsetTop,r=0;r<o.length;r+=1)if(e=o[r],e.getAttribute("data-sortable-key")!==t.getAttribute("data-sortable-key")){var l=e.offsetTop-s;l>0&&i>l&&(i=l,n=e)}return n}function o(e){for(var a="node-",o={},i=[],n=0;n<e.length;n+=1)id=a+(n+1),i.push(id),e[n]=t.addons.cloneWithProps(e[n],{className:"react-sortable-item",key:id,"data-sortable-key":id}),o[id]=e[n];return{map:o,ids:i}}var i=t.createClass({displayName:"ReactSortable",componentWillMount:function(){var t=o(this.props.children);this.setState({order:t.ids,sortableMap:t.map})},componentWillReceiveProps:function(t){if(t.children){var e=o(this.props.children);this.setState({order:e.ids,sortableMap:e.map})}},getInitialState:function(){return{order:[],startPosition:null,activeItem:null,sortableMap:{}}},onDragStop:function(){this.setState({activeItem:null,startPosition:null})},onDrag:function(){var t=this.refs.handle.getDOMNode(),e=a(t),o=t.getAttribute("data-sortable-key"),i=this.state.order,n=i.indexOf(o);i.splice(n,1);var s=null,r=i.length;e&&(s=e.getAttribute("data-sortable-key"),r=i.indexOf(s)),i.splice(r,0,o),this.setState({order:i})},onMouseDown:function(t){this.setState({mouseDownPosition:{x:t.clientX,y:t.clientY}})},onMouseMove:function(t){if(!this.state.activeItem){var a=this.state.mouseDownPosition;if(!a)return;if(Math.abs(t.clientX-a.x)>=5||Math.abs(t.clientY-a.y)>=5){var o=e(t.target),i=o.getBoundingClientRect(),n=t.nativeEvent;this.activeItem=o,this.setState({mouseDownPosition:null,activeItem:o.getAttribute("data-sortable-key"),startPosition:{x:i.left,y:i.top}},function(){this.refs.handle.handleDragStart(n)}.bind(this))}}},render:function(){var e,a=this.state.order.map(function(e){var a="";return this.state.activeItem===e&&(a+="react-sortable-item-active"),t.addons.cloneWithProps(this.state.sortableMap[e],{onMouseDown:this.onMouseDown,onMouseMove:this.onMouseMove,className:a})},this);if(this.state.activeItem){var o=this.state.startPosition;e=t.addons.cloneWithProps(this.state.sortableMap[this.state.activeItem],{className:"react-sortable-handle"}),e=t.createElement(ReactDrag,{onStop:this.onDragStop,onDrag:this.onDrag,ref:"handle",start:{x:o.x,y:o.y}},e)}return t.createElement("div",{ref:"wrapper"},a,e)}});return i});