function getClosestSortable(t){for(;t;){if(t.className&&t.className.indexOf("react-sortable-item")>=0)return t;t=t.parentNode}return null}function getNextNode(t){for(var e,a=t.parentNode,i=a.children,n=1/0,o=null,s=t.offsetTop,r=0;r<i.length;r+=1)if(e=i[r],e.getAttribute("data-sortable-key")!==t.getAttribute("data-sortable-key")){var l=e.offsetTop-s;l>0&&n>l&&(n=l,o=e)}return o}var ReactSortable=React.createClass({displayName:"ReactSortable",_indexChildren:function(t){var e,a=[],i="node-";this.sortableMap={};for(var n=0;n<t.length;n+=1)e=i+(n+1),a.push(e),t[n]=React.addons.cloneWithProps(t[n],{className:"react-sortable-item",key:e,"data-sortable-key":e}),this.sortableMap[e]=t[n];this.setState({order:a})},componentWillMount:function(){this._indexChildren(this.props.children),window.addEventListener("mouseup")},componentWillReceiveProps:function(t){t.children&&this._indexChildren(t.children)},getInitialState:function(){return this.activeNode=null,{order:[],activeItem:null}},onDragStop:function(){this.setState({activeItem:null})},onDrag:function(){var t=this.activeItem.nextSibling,e=getNextNode(this.refs.handle.getDOMNode());if(console.log(this.refs.handle),t!==e){var a=this.activeItem.getAttribute("data-sortable-key"),i=this.state.order,n=i.length;i.splice(i.indexOf(a),1),e&&(n=i.indexOf(e.getAttribute("data-sortable-key"))),i.splice(n,0,a);this.setState({order:i})}},onMouseDown:function(t){this.setState({initialCoordinates:{x:t.clientX,y:t.clientY}})},onMouseMove:function(t){if(!this.state.activeItem){var e=this.state.initialCoordinates;if(!e)return;if(Math.abs(t.clientX-e.x)>=5||Math.abs(t.clientY-e.y)>=5){var a=getClosestSortable(t.target),i=a.getBoundingClientRect(),n=t.nativeEvent;this.activeItem=a,this.setState({initialCoordinates:null,activeItem:a.getAttribute("data-sortable-key"),startPosition:{x:i.left,y:i.top}},function(){this.refs.handle.handleDragStart(n)}.bind(this))}}},render:function(){var t,e=this.state.order.map(function(t){var e="";return this.state.activeItem===t&&(e+="react-sortable-item-active"),React.addons.cloneWithProps(this.sortableMap[t],{onMouseDown:this.onMouseDown,onMouseMove:this.onMouseMove,className:e})},this);if(this.state.activeItem){var a=this.state.startPosition;t=React.addons.cloneWithProps(this.sortableMap[this.state.activeItem],{className:"react-sortable-handle"}),t=React.createElement(ReactDrag,{onStop:this.onDragStop,onDrag:this.onDrag,ref:"handle",start:{x:a.x,y:a.y}},t)}return React.createElement("div",{ref:"wrapper"},e,t)}});