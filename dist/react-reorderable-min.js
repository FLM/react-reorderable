!function(e,t){"function"==typeof define&&define.amd?define(["React"],t):"object"==typeof exports?module.exports=t(require("React")):e.ReactReorderable=t(e.React)}(this,function(e){function t(e){for(;e;){if(e.className&&e.className.indexOf("react-reorderable-item")>=0)return e;e=e.parentNode}return null}function r(e){for(var t,r=e.parentNode,a=r.children,o=1/0,i=null,n=e.offsetTop,s=0;s<a.length;s+=1)if(t=a[s],t.getAttribute("data-reorderable-key")!==e.getAttribute("data-reorderable-key")){var l=t.offsetTop-n;l>0&&o>l&&(o=l,i=t)}return i}function a(t){for(var r="node-",a={},o=[],i=0;i<t.length;i+=1)id=r+(i+1),o.push(id),t[i]=e.addons.cloneWithProps(t[i],{className:"react-reorderable-item",key:id,"data-reorderable-key":id}),a[id]=t[i];return{map:a,ids:o}}var o=e.createClass({displayName:"ReactReorderable",componentWillMount:function(){var e=a(this.props.children);this.setState({order:e.ids,reorderableMap:e.map})},componentWillReceiveProps:function(e){if(e.children){var t=a(this.props.children);this.setState({order:t.ids,reorderableMap:t.map})}},getInitialState:function(){return{order:[],startPosition:null,activeItem:null,reorderableMap:{}}},onDragStop:function(){this.setState({activeItem:null,startPosition:null})},onDrag:function(){var e=this.refs.handle.getDOMNode(),t=r(e),a=e.getAttribute("data-reorderable-key"),o=this.state.order,i=o.indexOf(a);o.splice(i,1);var n=null,s=o.length;t&&(n=t.getAttribute("data-reorderable-key"),s=o.indexOf(n)),o.splice(s,0,a),this.setState({order:o})},onMouseDown:function(e){this.setState({mouseDownPosition:{x:e.clientX,y:e.clientY}})},onMouseMove:function(e){if(!this.state.activeItem){var r=this.state.mouseDownPosition;if(!r)return;if(Math.abs(e.clientX-r.x)>=5||Math.abs(e.clientY-r.y)>=5){var a=t(e.target),o=a.getBoundingClientRect(),i=e.nativeEvent;this.activeItem=a,this.setState({mouseDownPosition:null,activeItem:a.getAttribute("data-reorderable-key"),startPosition:{x:o.left,y:o.top}},function(){this.refs.handle.handleDragStart(i)}.bind(this))}}},render:function(){var t,r=this.state.order.map(function(t){var r="";return this.state.activeItem===t&&(r+="react-reorderable-item-active"),e.addons.cloneWithProps(this.state.reorderableMap[t],{onMouseDown:this.onMouseDown,onMouseMove:this.onMouseMove,className:r})},this);if(this.state.activeItem){var a=this.state.startPosition;t=e.addons.cloneWithProps(this.state.reorderableMap[this.state.activeItem],{className:"react-reorderable-handle"}),t=e.createElement(ReactDrag,{onStop:this.onDragStop,onDrag:this.onDrag,ref:"handle",start:{x:a.x,y:a.y}},t)}return e.createElement("div",{ref:"wrapper"},r,t)}});return o});