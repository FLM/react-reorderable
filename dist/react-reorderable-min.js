!function(e,t){"function"==typeof define&&define.amd?define(["React"],t):"object"==typeof exports?module.exports=t(require("React")):e.ReactReorderable=t(e.React)}(this,function(e){function t(e){for(;e;){if(e.className&&e.className.indexOf("react-reorderable-item")>=0)return e;e=e.parentNode}return null}function r(e){for(var t,r=e.parentNode,a=r.children,o=1/0,n=null,i=e.offsetTop,s=0;s<a.length;s+=1)if(t=a[s],t.getAttribute("data-reorderable-key")!==e.getAttribute("data-reorderable-key")){var c=t.offsetTop-i;c>0&&o>c&&(o=c,n=t)}return n}function a(t){for(var r="node-",a={},o=[],n=0;n<t.length;n+=1)id=r+(n+1),o.push(id),t[n]=e.createElement("div",{className:"react-reorderable-item",key:id,"data-reorderable-key":id},t[n]),a[id]=t[n];return{map:a,ids:o}}var o=e.createClass({displayName:"ReactReorderable",componentWillMount:function(){var e=a(this.props.children);this.setState({order:e.ids,reorderableMap:e.map})},componentWillReceiveProps:function(e){if(e.children){var t=a(this.props.children);this.setState({order:t.ids,reorderableMap:t.map})}},getInitialState:function(){return{order:[],startPosition:null,activeItem:null,reorderableMap:{}}},onDragStop:function(){this.setState({activeItem:null,startPosition:null}),this.props.onDrop()},onDrag:function(){var e=this.refs.handle.getDOMNode(),t=r(e),a=e.getAttribute("data-reorderable-key"),o=this.state.order,n=o.indexOf(a);o.splice(n,1);var i=null,s=o.length;t&&(i=t.getAttribute("data-reorderable-key"),s=o.indexOf(i)),o.splice(s,0,a),this.setState({order:o}),this.props.onDrag(s),s!==n&&this.props.onChange()},onMouseDown:function(e){this.setState({mouseDownPosition:{x:e.clientX,y:e.clientY}})},onMouseMove:function(e){if(!this.state.activeItem){var r=this.state.mouseDownPosition;if(!r)return;if(Math.abs(e.clientX-r.x)>=5||Math.abs(e.clientY-r.y)>=5){var a=t(e.target),o=e.nativeEvent;this.activeItem=a,this.setState({mouseDownPosition:null,activeItem:a.getAttribute("data-reorderable-key"),startPosition:{x:a.offsetLeft,y:a.offsetTop}},function(){this.refs.handle.handleDragStart(o),this.props.onDragStart(this.refs.active)}.bind(this))}}},render:function(){var t,r=this.state.order.map(function(t){var r="";return this.state.activeItem===t&&(r+="react-reorderable-item-active"),e.addons.cloneWithProps(this.state.reorderableMap[t],{ref:"active",onMouseDown:this.onMouseDown,onMouseMove:this.onMouseMove,className:r})},this);if(this.state.activeItem){var a=this.state.startPosition;t=e.addons.cloneWithProps(this.state.reorderableMap[this.state.activeItem],{className:"react-reorderable-handle"}),t=e.createElement(ReactDrag,{onStop:this.onDragStop,onDrag:this.onDrag,ref:"handle",start:{x:a.x,y:a.y}},t)}return e.createElement("div",{ref:"wrapper"},r,t)}});return o.propTypes={onDragStart:e.PropTypes.func,onDrag:e.PropTypes.func,onDrop:e.PropTypes.func,onChange:e.PropTypes.func},o.defaultProps={onDragStart:function(){},onDrag:function(){},onDrop:function(){},onChange:function(){}},o});