!function(e,t){"function"==typeof define&&define.amd?define(["React"],t):"object"==typeof exports?module.exports=t(require("React")):e.ReactReorderable=t(e.React)}(this,function(e){function t(e){return n(e,"scrollTop")}function r(e){return n(e,"scrollLeft")}function n(e,t){for(var r=0;e;)r+=e[t]||0,e=e.parentNode;return r}function o(e){for(;e;){if(e.className&&e.className.indexOf("react-reorderable-item")>=0)return e;e=e.parentNode}return null}function i(e,t){var r=t.getBoundingClientRect(),n=r.top,o=r.left,i=r.width,a=r.height;return e.clientY<n||e.clientY>n+a?u.NONE:e.clientX>o&&e.clientX<o+.5*i?u.NEXT:e.clientX>o+.5*i&&e.clientX<o+i?u.PREVIOUS:u.NONE}function a(e,t){var r=t.getBoundingClientRect(),n=r.top,o=r.left,i=r.width,a=r.height;return e.clientX<o||e.clientX>o+i?u.NONE:e.clientY>n&&e.clientY<n+.5*a?u.NEXT:e.clientY>n+.5*a&&e.clientY<n+a?u.PREVIOUS:u.NONE}function s(e,t,r){var n,o=t.parentNode,s=o.children,l=!1,c={};r=r||"list";for(var d=0;d<s.length&&!l;d+=1)if(n=s[d],n.getAttribute("data-reorderable-key")!==t.getAttribute("data-reorderable-key")){var p;if(p="list"===r?a(e,n):i(e,n),p!==u.NONE)return c.node=n,c.type=p,c}return c}function l(t){for(var r="node-",n={},o=[],i=0;i<t.length;i+=1)id=r+(i+1),o.push(id),t[i]=e.createElement("div",{className:"react-reorderable-item",key:id,"data-reorderable-key":id},t[i]),n[id]=t[i];return{map:n,ids:o}}function c(e,t){for(var r=e.parentNode.querySelectorAll(t),n=0;n<r.length;n+=1)if(e===r[n])return!0;return!1}function d(e,t,r){var n=e.getAttribute("data-reorderable-key"),o=r.indexOf(n);r.splice(o,1);var i=t.node.getAttribute("data-reorderable-key"),a=r.indexOf(i);return t.type===u.PREVIOUS?r.splice(a+1,0,n):r.splice(a,0,n),r}var u={NONE:0,NEXT:1,PREVIOUS:2},p=e.createClass({displayName:"ReactReorderable",componentWillMount:function(){var e=l(this.props.children);this.setState({order:e.ids,reorderableMap:e.map}),window.addEventListener("mouseup",function(){this.setState({mouseDownPosition:null})}.bind(this))},componentWillReceiveProps:function(e){if(e.children){var t=l(e.children);this.setState({order:t.ids,reorderableMap:t.map})}},getInitialState:function(){return{order:[],startPosition:null,activeItem:null,reorderableMap:{}}},onDragStop:function(){this.setState({activeItem:null,startPosition:null}),this.props.onDrop(this.state.order.map(function(e){return this.state.reorderableMap[e].props.children},this))},onDrag:function(e){var t=this.refs.handle.getDOMNode(),r=s(e,t,this.props.mode);if(r&&r.node){for(var n=this.state.order.slice(),i=d(o(t),r,this.state.order),a=!1,l=0;l<i.length&&!a;l+=1)i[l]!==n[l]&&(a=!0);a&&this.props.onChange(this.state.order.map(function(e){return this.state.reorderableMap[e].props.children},this)),this.setState({order:i})}},onMouseDown:function(e){(!this.props.handle||c(e.target,this.props.handle))&&this.setState({mouseDownPosition:{x:e.clientX,y:e.clientY}})},onMouseMove:function(e){if(!this.state.activeItem){var n=this.state.mouseDownPosition;if(!n)return;if(Math.abs(e.clientX-n.x)>=5||Math.abs(e.clientY-n.y)>=5){var i=o(e.target),a=i.getBoundingClientRect(),s=e.nativeEvent,l=i.getAttribute("data-reorderable-key");this.props.onDragStart(this.state.reorderableMap[l]),this.activeItem=i,console.log(a.left+r(i.parentNode)),this.setState({mouseDownPosition:null,activeItem:l,startPosition:{x:a.left+r(i.parentNode),y:a.top+t(i.parentNode)}},function(){this.refs.handle.handleDragStart(s)}.bind(this))}}},render:function(){var t,r=this.state.order.map(function(t){var r=this.state.activeItem?"noselect ":"";return this.state.activeItem===t&&(r+="react-reorderable-item-active"),e.addons.cloneWithProps(this.state.reorderableMap[t],{ref:"active",onMouseDown:this.onMouseDown,onMouseMove:this.onMouseMove,className:r})},this);if(this.state.activeItem){var n=this.state.startPosition;t=e.addons.cloneWithProps(this.state.reorderableMap[this.state.activeItem],{className:"react-reorderable-handle"}),t=e.createElement(ReactDrag,{onStop:this.onDragStop,onDrag:this.onDrag,ref:"handle",start:{x:n.x,y:n.y}},t)}return e.createElement("div",{ref:"wrapper"},r,t)}});return p.propTypes={onDragStart:e.PropTypes.func,onDrag:e.PropTypes.func,onDrop:e.PropTypes.func,onChange:e.PropTypes.func},p.defaultProps={onDragStart:function(){},onDrag:function(){},onDrop:function(){},onChange:function(){}},p});