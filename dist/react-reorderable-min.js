!function(e,t){"function"==typeof define&&define.amd?define(["React"],t):"object"==typeof exports?module.exports=t(require("React")):e.ReactReorderable=t(e.React)}(this,function(e){function t(e){for(;e;){if(e.className&&e.className.indexOf("react-reorderable-item")>=0)return e;e=e.parentNode}return null}function r(e,t){var r=t.getBoundingClientRect(),a=r.top,n=r.left,o=r.width,i=r.height;return e.pageY<a||e.pageY>a+i?d.NONE:e.pageX>n&&e.pageX<n+.5*o?d.NEXT:e.pageX>n+.5*o&&e.pageX<n+o?d.PREVIOUS:d.NONE}function a(e,t){var r=t.getBoundingClientRect(),a=r.top,n=r.left,o=r.width,i=r.height;return e.pageX<n||e.pageX>n+o?d.NONE:e.pageY>a&&e.pageY<a+.5*i?d.NEXT:e.pageY>a+.5*i&&e.pageY<a+i?d.PREVIOUS:d.NONE}function n(e,t,n){var o,i=t.parentNode,s=i.children,l=!1,p={};n=n||"list";for(var c=0;c<s.length&&!l;c+=1)if(o=s[c],o.getAttribute("data-reorderable-key")!==t.getAttribute("data-reorderable-key")){var u;if(u="list"===n?a(e,o):r(e,o),u!==d.NONE)return p.node=o,p.type=u,p}return p}function o(t){for(var r="node-",a={},n=[],o=0;o<t.length;o+=1)id=r+(o+1),n.push(id),t[o]=e.createElement("div",{className:"react-reorderable-item",key:id,"data-reorderable-key":id},t[o]),a[id]=t[o];return{map:a,ids:n}}function i(e,t){for(var r=e.parentNode.querySelectorAll(t),a=0;a<r.length;a+=1)if(e===r[a])return!0;return!1}function s(e,t,r){var a=e.getAttribute("data-reorderable-key"),n=r.indexOf(a);r.splice(n,1);var o=t.node.getAttribute("data-reorderable-key"),i=r.indexOf(o);return t.type===d.PREVIOUS?r.splice(i+1,0,a):r.splice(i,0,a),r}var d={NONE:0,NEXT:1,PREVIOUS:2},l=e.createClass({displayName:"ReactReorderable",componentWillMount:function(){var e=o(this.props.children);this.setState({order:e.ids,reorderableMap:e.map}),window.addEventListener("mouseup",function(){this.setState({mouseDownPosition:null})}.bind(this))},componentWillReceiveProps:function(e){if(e.children){var t=o(e.children);this.setState({order:t.ids,reorderableMap:t.map})}},getInitialState:function(){return{order:[],startPosition:null,activeItem:null,reorderableMap:{}}},onDragStop:function(){this.setState({activeItem:null,startPosition:null}),this.props.onDrop(this.state.order.map(function(e){return this.state.reorderableMap[e].props.children},this))},onDrag:function(e){var r=this.refs.handle.getDOMNode(),a=n(e,r,this.props.mode);if(a&&a.node){for(var o=this.state.order.slice(),i=s(t(r),a,this.state.order),d=!1,l=0;l<i.length&&!d;l+=1)i[l]!==o[l]&&(d=!0);d&&this.props.onChange(this.state.order.map(function(e){return this.state.reorderableMap[e].props.children},this)),this.setState({order:i})}},onMouseDown:function(e){(!this.props.handle||i(e.target,this.props.handle))&&this.setState({mouseDownPosition:{x:e.clientX,y:e.clientY}})},onMouseMove:function(e){if(!this.state.activeItem){var r=this.state.mouseDownPosition;if(!r)return;if(Math.abs(e.clientX-r.x)>=5||Math.abs(e.clientY-r.y)>=5){var a=t(e.target),n=a.getBoundingClientRect(),o=e.nativeEvent,i=a.getAttribute("data-reorderable-key");this.props.onDragStart(this.state.reorderableMap[i]),this.activeItem=a,this.setState({mouseDownPosition:null,activeItem:i,startPosition:{x:n.left,y:n.top}},function(){this.refs.handle.handleDragStart(o)}.bind(this))}}},render:function(){var t,r=this.state.order.map(function(t){var r=this.state.activeItem?"noselect ":"";return this.state.activeItem===t&&(r+="react-reorderable-item-active"),e.addons.cloneWithProps(this.state.reorderableMap[t],{ref:"active",onMouseDown:this.onMouseDown,onMouseMove:this.onMouseMove,className:r})},this);if(this.state.activeItem){var a=this.state.startPosition;t=e.addons.cloneWithProps(this.state.reorderableMap[this.state.activeItem],{className:"react-reorderable-handle"}),t=e.createElement(ReactDrag,{onStop:this.onDragStop,onDrag:this.onDrag,ref:"handle",start:{x:a.x,y:a.y}},t)}return e.createElement("div",{ref:"wrapper"},r,t)}});return l.propTypes={onDragStart:e.PropTypes.func,onDrag:e.PropTypes.func,onDrop:e.PropTypes.func,onChange:e.PropTypes.func},l.defaultProps={onDragStart:function(){},onDrag:function(){},onDrop:function(){},onChange:function(){}},l});